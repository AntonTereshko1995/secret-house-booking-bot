import sys
import os

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))

from telegram import (InlineKeyboardButton, InlineKeyboardMarkup, Update)
from telegram.ext import (ContextTypes, ConversationHandler, CallbackQueryHandler, CallbackContext)
from src.handlers import menu_handler
from src.services.file_service import FileService
from src.constants import END, MENU, PRICE, STOPPING

def get_handler() -> ConversationHandler:
    handler = ConversationHandler(
        entry_points=[CallbackQueryHandler(send_prices, pattern=f"^{str(PRICE)}$")],
        states={ },
        fallbacks=[CallbackQueryHandler(back_navigation, pattern=f"^{END}$")],
        map_to_parent={
            END: MENU,
            STOPPING: END,
        })
    return handler

async def back_navigation(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await menu_handler.show_menu(update, context)
    return END

async def send_prices(update: Update, context: CallbackContext):
    tariffs = (
            "üè° <b>–¢–ê–†–ò–§ '–°–£–¢–û–ß–ù–´–ô'</b>\n"
            "‚úî <b>1 –¥–µ–Ω—å</b> ‚Äî 750 BYN\n"
            "‚úî <b>2 –¥–Ω—è</b> ‚Äî 1400 BYN\n"
            "‚úî <b>3 –¥–Ω—è</b> ‚Äî 2050 BYN\n"
            "üéÅ <b>–ë–æ–Ω—É—Å:</b> –ü—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç 2 –¥–Ω–µ–π ‚Äî –¥–∞—Ä–∏–º 12 —á–∞—Å–æ–≤ –≤ –ø–æ–¥–∞—Ä–æ–∫ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏!\n\n"
            "üîπ –í–∫–ª—é—á–∞–µ—Ç <b>–≤–µ—Å—å –¥–æ–º</b>:\n"
            "‚úÖ –î–æ—Å—Ç—É–ø –∫ <b>–¥–≤—É–º —Å–ø–∞–ª—å–Ω—è–º</b>\n"
            "‚úÖ <b>–°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞</b>\n"
            "‚úÖ <b>–°–∞—É–Ω–∞</b>\n"
            "‚úÖ –ü—Ä–æ—Å—Ç–æ—Ä–Ω–∞—è <b>–≥–æ—Å—Ç–∏–Ω–∞—è</b> —Å –∫–∞–º–∏–Ω–æ–º\n"
            "‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é <b>–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–Ω–∞—è –∫—É—Ö–Ω—è</b>\n\n"
            "üí° <b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</b>\n"
            "üîπ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π ‚Äî <b>6 —á–µ–ª–æ–≤–µ–∫</b>\n"
            "üîπ –°–≤–æ–±–æ–¥–Ω—ã–π <b>–≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–µ–∑–¥–∞</b>\n"
            "üì∏ <b>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è</b> –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ (2 —á–∞—Å–∞, –±—Ä–æ–Ω—å –∑–∞ –Ω–µ–¥–µ–ª—é)\n\n\n\n"

            "‚è≥ <b>–¢–ê–†–ò–§ '12 –ß–ê–°–û–í'</b>\n"
            "‚úî <b>–û–¥–Ω–∞ —Å–ø–∞–ª—å–Ω—è</b> ‚Äî 300 BYN\n"
            "‚úî <b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</b>\n"
            "‚ûï –í—Ç–æ—Ä–∞—è —Å–ø–∞–ª—å–Ω—è ‚Äî 70 BYN\n"
            "‚ûï <b>–°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞</b> ‚Äî 70 BYN\n"
            "‚ûï <b>–°–∞—É–Ω–∞</b> ‚Äî 70 BYN\n"
            "‚ûï –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π 1 —á–∞—Å ‚Äî 40 BYN\n\n"
            "üîπ <b>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π</b> ‚Äî 3 —á–µ–ª–æ–≤–µ–∫–∞\n"
            "üîπ –°–≤–æ–±–æ–¥–Ω—ã–π <b>–≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–µ–∑–¥–∞</b>\n\n"
            "üí° <b>–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ –≤ –æ—Å–æ–±–µ–Ω–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ</b>\n\n\n\n"

            "üíº <b>–¢–ê–†–ò–§ '–†–ê–ë–û–ß–ò–ô' (—Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –ø–æ —á–µ—Ç–≤–µ—Ä–≥)</b>\n"
            "‚úî <b>–û–¥–Ω–∞ —Å–ø–∞–ª—å–Ω—è</b> ‚Äî 200 BYN\n"
            "‚úî <b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</b>\n"
            "‚ûï –í—Ç–æ—Ä–∞—è —Å–ø–∞–ª—å–Ω—è ‚Äî 50 BYN\n"
            "‚ûï <b>–°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞</b> ‚Äî 50 BYN\n"
            "‚ûï <b>–°–∞—É–Ω–∞</b> ‚Äî 70 BYN\n"
            "‚ûï –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π 1 —á–∞—Å ‚Äî 40 BYN\n\n"
            "üîπ –í–∫–ª—é—á–∞–µ—Ç <b>–æ–¥–Ω—É —Å–ø–∞–ª—å–Ω—é –Ω–∞ –≤—ã–±–æ—Ä</b>\n"
            "üîπ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π ‚Äî <b>2 —á–µ–ª–æ–≤–µ–∫–∞</b>\n"
            "üîπ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ <b>–≤ –¥–≤—É—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞—Ö:</b>\n"
            "üìå <b>—Å 11:00 –¥–æ 20:00</b>\n"
            "üåô <b>—Å 22:00 –¥–æ 09:00</b>\n\n"
            "üí° <b>–û—Ç–ª–∏—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏–ª–∏ –Ω–æ—á–Ω–æ–≥–æ —Ä–µ–ª–∞–∫—Å–∞!</b>\n\n\n\n"

            "üî• <b>–¢–ê–†–ò–§ '–ò–ù–ö–û–ì–ù–ò–¢–û' (VIP-–æ–ø—Ü–∏—è)</b>\n"
            "‚úî <b>–°—É—Ç–∫–∏</b> ‚Äî 1000 BYN\n"
            "‚úî <b>12 —á–∞—Å–æ–≤</b> ‚Äî 650 BYN\n\n"
            "üîπ –í–∫–ª—é—á–∞–µ—Ç <b>–≤–µ—Å—å –¥–æ–º</b>, <b>–≤—Å–µ –∫–æ–º–Ω–∞—Ç—ã</b>, <b>—Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–Ω–∞—Ç—É</b> –∏ <b>—Å–∞—É–Ω—É</b>\n"
            "üîπ <b>–ë–µ–∑ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞</b>\n"
            "üîπ <b>–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–∞–º–µ—Ä –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É –¥–æ–º–∞</b>\n\n"
            "üéÅ <b>–ü–æ–¥–∞—Ä–∫–∏:</b>\n"
            "üöò <b>–¢—Ä–∞–Ω—Å—Ñ–µ—Ä</b> –æ—Ç/–¥–æ –¥–æ–º–∞ –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞\n"
            "üç∑ <b>–ë—É—Ç—ã–ª–∫–∞ –≤–∏–Ω–∞ –∏ –ª—ë–≥–∫–∏–µ –∑–∞–∫—É—Å–∫–∏</b>\n"
            "üì∏ <b>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è</b> –ø—Ä–∏ –∞—Ä–µ–Ω–¥–µ –Ω–∞ —Å—É—Ç–∫–∏ (2 —á–∞—Å–∞, –±—Ä–æ–Ω—å –∑–∞ –Ω–µ–¥–µ–ª—é)\n\n"
            "üí° <b>–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤</b>")
    
    keyboard = [[InlineKeyboardButton("–û—Ç–º–µ–Ω–∞", callback_data=END)]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.callback_query.answer()
    await update.callback_query.edit_message_text(
        text=tariffs,
        parse_mode='HTML',
        reply_markup=reply_markup)
    return MENU

