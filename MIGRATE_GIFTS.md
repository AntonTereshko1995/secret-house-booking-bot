# Миграция подарочных сертификатов

## Проблема

При первой миграции gift-ы с `user_id=NULL` не были смигрированы (все 13 сертификатов).

## Решение

Запустить скрипт `migrate_missing_gifts.py` на сервере Amvera.

## Инструкция для продакшена

1. **Убедиться, что SQLite база существует:**
   ```bash
   ls -la /data/the_secret_house.db
   ```

2. **Запустить скрипт миграции:**
   ```bash
   python migrate_missing_gifts.py
   ```

3. **Скрипт покажет:**
   - Сколько gift-ов в SQLite
   - Сколько gift-ов в PostgreSQL
   - Список недостающих gift-ов
   - Запрос подтверждения

4. **Подтвердить миграцию:**
   ```
   Migrate these gifts to PostgreSQL? (yes/no): yes
   ```

5. **Результат:**
   ```
   ✓ SUCCESS: Gifts migrated successfully!
   ```

## Что делает скрипт

- ✅ Находит все gift-ы в SQLite (включая с NULL user_id)
- ✅ Проверяет, какие уже есть в PostgreSQL
- ✅ Мигрирует только недостающие
- ✅ Сохраняет оригинальные ID
- ✅ Сбрасывает sequence для будущих вставок
- ✅ Использует транзакции (откат при ошибке)

## Ожидаемый результат

После миграции PostgreSQL должна содержать **13 gift-ов** (подарочных сертификатов).

## Безопасность

- ✅ Скрипт запрашивает подтверждение
- ✅ Не удаляет данные из SQLite (только чтение)
- ✅ Не перезаписывает существующие gift-ы
- ✅ Использует транзакции
